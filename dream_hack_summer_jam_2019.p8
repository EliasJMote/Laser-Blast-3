pico-8 cartridge // http://www.pico-8.com
version 17
__lua__
function _init()
	globals = {}

	-- initialize the player
	globals.player = {}
	globals.player.x = 56
	globals.player.y = 56
	globals.player.spr = 1
	globals.player.spd = 2
	globals.player.flip_x = true
	globals.player.shots = {}
	globals.player_camera_y = 0

	-- initialize camera position
	globals.camera = {}
	globals.camera.x = 0
	globals.camera.y = 0

	-- initialize the sky height
	globals.sky_hgt = 64
	
	-- initialize the game timer
	globals.timer = 0

	--
	globals.enemies = {}
	globals.enemy_shots = {}
end

function _update()

	local g = globals
	-- horizontal player movement --
	-- left
	if(btn(0) and g.player.x > 0) then
		g.player.x -= g.player.spd

	-- right
	elseif(btn(1) and g.player.x + 24 < 128) then
		g.player.x += g.player.spd
	end

	-- vertical player movement --
	-- up
	if(btn(2) and g.player.y > 0) then
		g.player.y -= g.player.spd

	-- down
	elseif(btn(3) and g.player.y + 32 < 128) then
		g.player.y += g.player.spd
	end

	-- decrease sky size when the player is high up
	if(g.player.y <= 32 and g.camera.y < 32) then
		g.camera.y += 1
		g.player_camera_y -= 1

	-- increase sky size when the player is low down
	elseif(g.player.y + 24 >= 128-32 and g.camera.y > 0) then
		g.camera.y -= 1
		g.player_camera_y += 1
	end

	-- flip the player depending on which side they are on
	if(g.player.x >= (128-24)/2) then
		g.player.flip_x = true
	else
		g.player.flip_x = false
	end

	-- spawn player attack
	if(btnp(4)) then
		local s = {}
		s.x = g.player.x + 24 / 2 - 4
		s.y = g.player.y + 32 / 2 - 4 - 4
		s.camera_y = g.player_camera_y
		s.timer = 0
		add(g.player.shots, s)
	end

	-- update player shots so they travel to the background
	for i in all(g.player.shots) do
		i.timer += 0.05
		if(i.timer >= 0.05 * 75) then
			del(g.player.shots, i)
		end
	end

	-- update timer
	g.timer = (g.timer + 1) % 32000
end

function _draw()
	local g = globals
	cls()

	-- draw the backgrounds
	-- draw the sky
	rectfill(0, 0, 128, globals.sky_hgt + g.camera.y, 12)

	line(0, g.camera.y + 64 - 14, 128, g.camera.y + 64 - 14, 7)
	line(0, g.camera.y + 64 - 12, 128, g.camera.y + 64 - 12, 7)
	line(0, g.camera.y + 64 - 10, 128, g.camera.y + 64 - 10, 7)
	rectfill(0, g.camera.y + 64 - 8, 128, g.camera.y + 64 - 6, 7)
	rectfill(0, g.camera.y + 64 - 4, 128, g.camera.y + 64 - 2, 7)


	-- draw the grass
	rectfill(0, g.camera.y + 64, 128, 128, 3)

	-- draw player projectiles
	for i in all(g.player.shots) do
		sspr(13*8, 0, 8, 8, i.x, i.y + i.camera_y + g.camera.y, 8/ceil(i.timer), 8/ceil(i.timer))
	end

	-- draw the player
	palt(11, true)
	palt(0, false)
	spr(g.player.spr+3*(flr(g.timer / 6) % 4), g.player.x, g.player.y, 3, 4, g.player.flip_x)
	palt(11, false)
	palt(0, true)

end
__gfx__
00000000bbbbbbbb1111bbbbbbbbbbbbbbbbbbbb1111bbbbbbbbbbbbbbbbbbbb1111bbbbbbbbbbbbbbbbbbbb1111bbbbbbbbbbbb005555000000000000000000
00000000bbbbbbbb1cc11bbbbbbbbbbbbbbbbbbb11c11bbbbbbbbbbbbbbbbbbb1cc11bbbbbbbbbbbbbbbbbbb11c11bbbbbbbbbbb055665500000000000000000
00700700bbbbbbb11c111bbbbbbbbbbbbbbbbbb11c111bbbbbbbbbbbbbbbbbb11c111bbbbbbbbbbbbbbbbbb1111c1bbbbbbbbbbb556666550000000000000000
00077000bbbbbbb111c11bbbbbbbbbbbbbbbbbb111111bbbbbbbbbbbbbbbbbb111111bbbbbbbbbbbbbbbbbb111111bbbbbbbbbbb566776650000000000000000
00077000bbbbbb91c1111fbbbbbbbbbbbbbbbb91c1111fbbbbbbbbbbbbbbbb91c1111fbbbbbbbbbbbbbbbb91c1111fbbbbbbbbbb566776650000000000000000
00700700bbbbbf91c11119fbbbbbbbbbbbbbbf91c11119fbbbbbbbbbbbbbbf91c11119fbbbbbbbbbbbbbbf91111119fbbbbbbbbb556666550000000000000000
00000000bbbbf991c1111990bbbbbbbbbbbbf991c1111990bbbbbbbbbbbbf991c1111990bbbbbbbbbbbbf99111111990bbbbbbbb055665500000000000000000
00000000bbbb001cc11119900bbbbbbbbbbb001c111119900bbbbbbbbbbb001cc11119900bbbbbbbbbbb0001c11119900bbbbbbb005555000000000000000000
00000000bbb0001c1111190000bbbbbbbbb0001c1111190000bbbbbbbbb0001c1111190000bbbbbbbbb00001c111190000bbbbbb000000000000000000000000
00000000bbb0001c11c199b00099bbbbbbb0011111c199b00099bbbbbbb0001c111199b00099bbbbbbb000b1c11119b00099bbbb000000000000000000000000
00000000bbb00011c11199bb097f9bbbbbb001c1111199bb097f9bbbbbb00011c1c199bb097f9bbbbbb000b1c11199bb097f9bbb000000000000000000000000
00000000bbb00b1111100bbbb9f7fbbbbbb00b1111100bbbb9f7fbbbbbb00b1111100bbbb9f7fbbbbbb00bb11c110bbbb9f7fbbb000000000000000000000000
00000000bbb00b1c11100bbbbb9f7bbbbbb00bbb00000bbbbb9f7bbbbbb00b1c11100bbbbb9f7bbbbbb00bbb11100bbbbb9f7bbb000000000000000000000000
00000000bbb00bb111000bbbbbbbbbbbbbb00bbb00000bbbbbbbbbbbbbb00bb111000bbbbbbbbbbbbbb00bbb00000bbbbbbbbbbb000000000000000000000000
00000000bbb099bb00000bbbbbbbbbbbbbb099bb00000bbbbbbbbbbbbbb099bb00000bbbbbbbbbbbbbb099bb00000bbbbbbbbbbb000000000000000000000000
00000000bbb999b9999999bbbbbbbbbbbbb999b9999999bbbbbbbbbbbbb999b9999999bbbbbbbbbbbbb999b9999999bbbbbbbbbb000000000000000000000000
00000000bbbb99b99ff999bbbbbbbbbbbbbb99b99ff999bbbbbbbbbbbbbb99b99ff999bbbbbbbbbbbbbb99b99ff999bbbbbbbbbb000000000000000000000000
00000000bbbbbbb9f999999bbbbbbbbbbbbbbbb9f999999bbbbbbbbbbbbbbbb9f999999bbbbbbbbbbbbbbbb9f999999bbbbbbbbb000000000000000000000000
00000000bbbbbb999999999bbbbbbbbbbbbbbb999999999bbbbbbbbbbbbbbb999999999bbbbbbbbbbbbbbb999999999bbbbbbbbb000000000000000000000000
00000000bbbbbb999999999bbbbbbbbbbbbbbb999999999bbbbbbbbbbbbbbb999999999bbbbbbbbbbbbbbb999999999bbbbbbbbb000000000000000000000000
00000000bbbbbb999999999bbbbbbbbbbbbbbb999999999bbbbbbbbbbbbbbb999999999bbbbbbbbbbbbbbb999999999bbbbbbbbb000000000000000000000000
00000000bbbbbbb00bbb000bbbbbbbbbbbbbbbb00bbb000bbbbbbbbbbbbbbbb00bbb000bbbbbbbbbbbbbbbb00bbb000bbbbbbbbb000000000000000000000000
00000000bbbbbbb00bbb000bbbbbbbbbbbbbbbb00bbb000bbbbbbbbbbbbbbbb00bbb000bbbbbbbbbbbbbbbb00bbb000bbbbbbbbb000000000000000000000000
00000000bbbbbbb00bbb000bbbbbbbbbbbbbbbb00bbb000bbbbbbbbbbbbbbbb00bbb000bbbbbbbbbbbbbbbb00bbb000bbbbbbbbb000000000000000000000000
00000000bbbbbb000bbbb00bbbbbbbbbbbbbbb000bbbb00bbbbbbbbbbbbbbb000bbbb00bbbbbbbbbbbbbbb000bbbb00bbbbbbbbb000000000000000000000000
00000000bbbbbb000bbbb00bbbbbbbbbbbbbbb000bbbb00bbbbbbbbbbbbbbb000bbbb00bbbbbbbbbbbbbbb000bbbb00bbbbbbbbb000000000000000000000000
00000000bbbbbb000bbbb00bbbbbbbbbbbbbbb000bbbb00bbbbbbbbbbbbbbb000bbbb00bbbbbbbbbbbbbbb000bbbb00bbbbbbbbb000000000000000000000000
00000000bbbbbb00bbbbb000bbbbbbbbbbbbbb00bbbbb000bbbbbbbbbbbbbb00bbbbb000bbbbbbbbbbbbbb00bbbbb000bbbbbbbb000000000000000000000000
00000000bbbbb990bbbbb099bbbbbbbbbbbbb990bbbbb0998bbbbbbbbbbbb990bbbbb099bbbbbbbbbbbbb990bbbbb0998bbbbbbb000000000000000000000000
00000000bbbbb999bbbbb999bbbbbbbbbbbb89998bbb89998bbbbbbbbbbbb999bbbbb999bbbbbbbbbbbb89998bbb89998bbbbbbb000000000000000000000000
00000000bbbbbb99bbbbb99bbbbbbbbbbbbb88998bbb89988bbbbbbbbbbbbb99bbbbb99bbbbbbbbbbbbb88998bbb89988bbbbbbb000000000000000000000000
00000000bbbbbbbbbbbbbbbbbbbbbbbbbbbbb878bbbbb878bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb878bbbbb878bbbbbbbb000000000000000000000000
00000000000000001111000000000000000000001111000000000000000000001111000000000000000000001111000000000000000000000000000000000000
00000000000000001cc1100000000000000000001cc1100000000000000000001cc1100000000000000000001cc1000000000000000000000000000000000000
00000000000000011c11100000000000000000011c11100000000000000000011c11100000000000000000011111100000000000000000000000000000000000
000000000000000111c11000000000000000000111111000000000000000000111c1100000000000000000011111100000000000000000000000000000000000
0000000000000091c1111f000000000000000091c1111f000000000000000091c1111f000000000000000091c1111f0000000000000000000000000000000000
0000000000000f91c11119f00000000000000a91c11119f00000000000000f91c11119f00000000000000f91111119f000000000000000000000000000000000
000000000000f991c1111999000000000000f991c1111999000000000000f991c1111999000000000000f9911111199900000000000000000000000000000000
000000000000991cc1111999900000000000991c11111999900000000000991cc1111999900000000000999c1111199990000000000000000000000000000000
000000000009991c11111999990000000009991c11111999990000000009991c11111999990000000009999c1111199999000000000000000000000000000000
000000000009991c11c19909991100000009911111c19909991100000009991c11c19909991100000009990c11c1190999110000000000000000000000000000
0000000000099911c111990091c11000000991c11111990091c1100000099911c111990091c11000000999011111990091c11000000000000000000000000000
000000000009901111199000011c10000009901c1c199000011c10000009901111199000011c10000009900c11119000011c1000000000000000000000000000
00000000000f901c1119900000117000000f90009999900000117000000f901c1119900000117000000f9000cc19900000117000000000000000000000000000
00000000000f90011199900000000000000f90009999900000000000000f90011199900000000000000f90009999900000000000000000000000000000000000
00000000000911009999900000000000000911009999900000000000000911009999900000000000000911009999900000000000000000000000000000000000
0000000000011101111111000000000000011101c111110000000000000111011111110000000000000111011111110000000000000000000000000000000000
0000000000001101c1cc1100000000000000110c11cc11000000000000001101c1cc1100000000000000110c11c1110000000000000000000000000000000000
000000000000000c11111110000000000000000c11111c00000000000000000c1111111000000000000000011c111c1000000000000000000000000000000000
00000000000000c111c1c11000000000000000c111c1111000000000000000c111c1c11000000000000000111111c11000000000000000000000000000000000
0000000000000011c11111c00000000000000c111c1c11100000000000000011c11111c00000000000000011c11c11c000000000000000000000000000000000
00000000000000c11cc11c100000000000000111c111111000000000000000c11cc11c1000000000000000c111c11cc000000000000000000000000000000000
00000000000000099000999000000000000000099000999000000000000000099000999000000000000000099000999000000000000000000000000000000000
00000000000000099000999000000000000000099000999000000000000000099000999000000000000000099000999000000000000000000000000000000000
000000000000000f90009990000000000000000f90009990000000000000000f90009990000000000000000f9000999000000000000000000000000000000000
000000000000009990000f90000000000000009990000f90000000000000009990000f90000000000000009990000f9000000000000000000000000000000000
00000000000000f990000f9000000000000000f990000f9000000000000000f990000f9000000000000000f990000f9000000000000000000000000000000000
00000000000000f99000099000000000000000f99000099000000000000000f99000099000000000000000f99000099000000000000000000000000000000000
00000000000000990000099900000000000000990000099900000000000000990000099900000000000000990000099900000000000000000000000000000000
000000000000011900000911000000000000c11900000911c00000000000011900000911000000000000c11900000911c0000000000000000000000000000000
000000000000011100000111000000000000c111c000c111c00000000000011100000111000000000000c111c000c111c0000000000000000000000000000000
000000000000001100000110000000000000cc11c000c11cc00000000000001100000110000000000000cc11c000c11cc0000000000000000000000000000000
0000000000000000000000000000000000000c7c00000c7c0000000000000000000000000000000000000c7c00000c7c00000000000000000000000000000000
